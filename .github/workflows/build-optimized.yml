name: Build optimized

on:
  workflow_dispatch:

jobs:
  linux:
    runs-on: ubuntu-latest
    container: ghcr.io/pyca/cryptography-manylinux_2_28:x86_64
    steps:
    - uses: actions/checkout@v4
    - name: Dependencies
      run: dnf install -y gtk3-devel zip
    - name: Build
      run: ./make-linux.sh
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4.3.1
      with:
        name: linux-x64-gui.zip
        path: ./flips

  windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - name: Build
      run: bash ./make-windows.sh
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4.3.1
      with:
        name: windows-x64-gui.zip
        path: ./flips.exe

  macos:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - name: Dependencies
      run: brew install gtk+3 libomp llvm
    - name: Build
      run: CXX=/opt/homebrew/opt/llvm/bin/clang++ TARGET=gtk ./make-macos.sh
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4.3.1
      with:
        name: macos-m1-gui.zip
        path: ./flips
